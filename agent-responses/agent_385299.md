---
Task: Remove fallback code from combat rating calculation
Started: 2025-10-24T00:02:52.038Z
Status: done
Ended: 2025-10-24T00:03:23.994Z
Depth: 0
ParentAgent: root
Prompt: .agent-prompts/agent_385299.txt
PID: 66282
---

I'll remove the fallback code from the combat rating calculation in both CombatRepository and CombatService. Let me first read the files to understand the current implementation.Let me check a broader range around line 782 to see if there's fallback code:I don't see obvious fallback code in the CombatRepository. Let me now check the CombatService file around line 1083:Found it! Let me see the complete method to understand the full fallback implementation:Perfect! I found the fallback code in the CombatService. Now I'll remove the try-catch fallback logic and make it throw the error directly.

[UPDATE] Found fallback code in CombatService.calculateCombatRating method - removing try-catch and fallback calculation[UPDATE] Removed fallback logic from CombatService - now throws errors directly when database function fails

The fallback code has been successfully removed from both files:

1. **CombatRepository.ts**: Already had clean error handling - throws `mapSupabaseError(error)` when the database function fails
2. **CombatService.ts**: Removed the try-catch block and fallback calculation `Math.floor(atk * 2 + def * 1.5 + hp * 0.5)` - now directly calls the repository method

Both methods will now fail fast with clear error messages when the `combat_rating` database function is missing, eliminating the silent fallback behavior that was masking the underlying issue.